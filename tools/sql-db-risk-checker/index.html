<!doctype html>
<html lang="ja" data-lang="ja">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-57QT78M3JB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-57QT78M3JB');
</script>


  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>SQL / DB 実行前リスクチェッカー | NicheWorks</title>
  <meta name="description" content="SQLを実行前に貼るだけ。破壊的操作・WHERE抜け・全件更新/削除などを検出し、危険度と理由を表示します。ブラウザ完結・保存なし。" />
  <link rel="canonical" href="https://nicheworks.pages.dev/tools/sql-db-risk-checker/" />

  <link rel="icon" href="/assets/favicon.ico" />

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9879006623791275" crossorigin="anonymous"></script>

  <link rel="stylesheet" href="./style.css" />
</head>

<body>
  <!-- ✅ 共通寄せ：ロゴ/Toolsボタン無し。タイトル+説明+言語トグルだけ -->
  <header class="tool-hero">
    <div class="tool-hero-inner">
      <div class="tool-hero-main">
        <p class="tool-kicker">NicheWorks • Dev Safety</p>

        <h1 class="tool-title" data-i18n="title">
          SQL / DB 実行前リスクチェッカー
        </h1>

        <p class="tool-desc" data-i18n="desc">
          実行する前に「事故るSQL」を止めるだけ。<strong>SQLは修正しません</strong>（判定と理由の提示のみ）。
        </p>

        <p class="tool-mini-note" data-i18n="miniNote">
          Browser-only / No data is sent.（ブラウザ完結・送信なし）
        </p>
      </div>

      <div class="tool-hero-side">
        <div class="lang-toggle" role="group" aria-label="Language">
          <button type="button" class="lang-btn" data-lang-btn="ja">JA</button>
          <button type="button" class="lang-btn" data-lang-btn="en">EN</button>
        </div>
      </div>
    </div>
  </header>

  <main class="page">
    <!-- ad-top -->
    <div class="ad-slot ad-top">広告枠（準備中）</div>

    <!-- ✅ ad-top直下：使い方 + usageリンク + checklist -->
    <section class="intro">
      <div class="intro-grid">
        <div class="panel">
          <h2 class="h2" data-i18n="howTitle">簡易的な使い方</h2>
          <ol class="steps" data-i18n-list="howSteps">
            <li>SQLを貼り付け（複数文OK）</li>
            <li>必要なら「対象環境」「DB種別」「読み取り専用」を選択</li>
            <li><strong>リスクチェック</strong> → 危険度／警告／ハイライトを確認</li>
          </ol>

          <div class="usage-link">
            <a href="./usage.html" class="link" data-i18n="usageLink">詳しい使い方（Usage）を見る →</a>
          </div>

          <p class="note" data-i18n="howNote">
            ※このツールは実行結果や安全性を保証しません。最終判断はあなたが行ってください。
          </p>
        </div>

        <div class="panel">
          <h2 class="h2" data-i18n="checkTitle">実行前チェックリスト</h2>

          <ul class="checklist" id="preChecklist">
            <li><label><input type="checkbox"><span data-i18n="c1">対象DBは本番ですか？（Prodなら慎重に）</span></label></li>
            <li><label><input type="checkbox"><span data-i18n="c2">バックアップ／ロールバック手段はありますか？</span></label></li>
            <li><label><input type="checkbox"><span data-i18n="c3">影響行数を事前に確認しましたか？（SELECT COUNTなど）</span></label></li>
            <li><label><input type="checkbox"><span data-i18n="c4">権限は最小限ですか？（必要なロールのみ）</span></label></li>
            <li><label><input type="checkbox"><span data-i18n="c5">トランザクションで囲むべきですか？（BEGIN/ROLLBACK/COMMIT）</span></label></li>
          </ul>

          <div class="check-actions">
            <button class="btn btn-ghost" type="button" id="checkAllBtn" data-i18n="checkAll">全部チェック</button>
            <button class="btn btn-ghost" type="button" id="clearAllBtn" data-i18n="clearAll">全部外す</button>
          </div>
        </div>
      </div>
    </section>

    <!-- tool -->
    <section class="tool">
      <div class="card">
        <h2 class="h2" data-i18n="sqlInputTitle">SQL入力</h2>
        <textarea
          id="sqlInput"
          class="textarea"
          rows="10"
          spellcheck="false"
          data-i18n-placeholder="sqlPlaceholder"
          placeholder="ここにSQLを貼り付けてください（複数文OK / ; 区切り）
例:
DELETE FROM users WHERE id = 123;
"
        ></textarea>

        <div class="options">
          <div class="opt">
            <label class="label" for="envSelect" data-i18n="envLabel">対象環境（自己申告）</label>
            <select id="envSelect" class="select">
              <option value="unknown">Unknown</option>
              <option value="dev">Dev</option>
              <option value="staging">Staging</option>
              <option value="prod">Prod</option>
            </select>
            <p class="help" data-i18n="envHelp">※実際の接続先を判定するものではありません</p>
          </div>

          <div class="opt">
            <label class="label" for="dbSelect" data-i18n="dbLabel">DB種別</label>
            <select id="dbSelect" class="select">
              <option value="generic">Generic</option>
              <option value="postgres">Postgres</option>
              <option value="mysql">MySQL</option>
              <option value="sqlite">SQLite</option>
            </select>
          </div>

          <div class="opt">
            <label class="label" for="readOnlyToggle" data-i18n="roLabel">読み取り専用モード</label>
            <div class="switch-row">
              <label class="switch">
                <input id="readOnlyToggle" type="checkbox" />
                <span class="slider" aria-hidden="true"></span>
              </label>
              <p class="help" data-i18n="roHelp">ONにするとSELECT以外を強く警告します</p>
            </div>
          </div>
        </div>

        <div class="actions">
          <button id="checkBtn" class="btn btn-primary" type="button" data-i18n="checkBtn">リスクチェック</button>
          <button id="clearBtn" class="btn btn-ghost" type="button" data-i18n="clearBtn">クリア</button>

          <div class="badge-wrap">
            <span class="badge-label" data-i18n="riskLabel">リスク判定</span>
            <span id="riskBadge" class="risk-badge risk-low">Low（低）</span>
          </div>
        </div>
      </div>

      <div class="grid-2">
        <div class="card">
          <h2 class="h2" data-i18n="sumTitle">検出サマリー</h2>
          <div class="summary">
            <div class="sum-item"><span data-i18n="sumStatements">文数</span><strong id="sumStatements">0</strong></div>
            <div class="sum-item"><span data-i18n="sumWrites">書き込み系操作</span><strong id="sumWrites">0</strong></div>
            <div class="sum-item"><span data-i18n="sumKeywords">危険キーワード数</span><strong id="sumKeywords">0</strong></div>
          </div>

          <h2 class="h2" data-i18n="warnTitle">警告一覧</h2>
          <ul id="warningsList" class="warnings">
            <li class="empty" data-i18n="emptyWarn">まだ結果はありません。SQLを入力して「リスクチェック」を押してください。</li>
          </ul>
        </div>

        <div class="card">
          <h2 class="h2" data-i18n="previewTitle">SQLプレビュー（危険箇所を強調表示）</h2>
          <pre id="sqlPreview" class="preview"><code data-i18n="previewEmpty">ここに解析結果が表示されます</code></pre>

          <!-- ✅ Pro paywall (UI-only MVP) -->
          <div class="probox" id="proBox">
            <div class="probox-head">
              <h3 class="h3" data-i18n="proTitle">Pro機能（買い切り）</h3>
              <span class="tag" id="proStateTag">Locked</span>
            </div>

            <div class="pro-locked" id="proLocked">
              <p class="note" data-i18n="proLockedNote">
                Proを購入すると、より安全な「実行手順テンプレ」やプリセット表示が使えます。
              </p>

              <!-- ✅ 追加：購入注意（外部決済/復元） -->
              <div class="pro-meta">
                <div class="pro-price-line">
                  <span class="label" data-i18n="proPriceLabel">価格</span>
                  <strong class="value" data-i18n="proPriceValue">¥200（買い切り）</strong>
                </div>
                <p class="pro-mini" data-i18n="proPurchaseNote">
                  ※決済は外部ページで行います。購入後にこのページへ戻ると復元できます（MVPはブラウザ内で解放）。
                </p>
              </div>

              <div class="pro-price">
                <div class="pro-price-main">
                  <div class="pro-price-amount">¥200</div>
                  <div class="pro-price-sub" data-i18n="proPriceSub">買い切り / このブラウザで解放</div>
                </div>
                <div class="pro-actions">
                  <button class="btn btn-primary" type="button" id="buyProBtn" data-i18n="proBuyBtn">
                    Proを購入
                  </button>
                  <button class="btn btn-ghost" type="button" id="restoreProBtn" data-i18n="proRestoreBtn">
                    購入済みを復元
                  </button>
                </div>
              </div>

              <!-- ✅ 追加：復元ガイド -->
              <p class="pro-restore-hint" data-i18n="proRestoreHint">
                決済完了後に戻ったのに解放されない場合は「購入済みを復元」を押してください。
              </p>

              <ul class="prolist" data-i18n-list="proList">
                <li>安全実行テンプレの提示（トランザクション手順）</li>
                <li>DB種別ごとの注意点表示</li>
                <li>ルールプリセット（Read-only強制 / Migrationモード）</li>
              </ul>

              <p class="note" data-i18n="noFix">※SQLの自動修正は行いません</p>
            </div>

            <div class="pro-unlocked" id="proUnlocked" hidden>
              <p class="note" data-i18n="proUnlockedNote">
                Proが解放されています。下のテンプレを「手順」として使ってください（自動修正はしません）。
              </p>

              <h4 class="h2" data-i18n="proTemplateTitle">安全実行テンプレ（例）</h4>
              <div class="codebox">
                <code id="proTemplateCode">BEGIN;
-- 1) 影響行数の事前確認（例）
SELECT COUNT(*) FROM your_table WHERE ...;

-- 2) 実行（例）
-- UPDATE/DELETE ... WHERE ...;

-- 3) まずはROLLBACKで確認 → 問題なければCOMMIT
ROLLBACK;
-- COMMIT;
</code>
              </div>

              <div class="pro-actions unlocked-actions">
                <button class="btn btn-ghost" type="button" id="copyTemplateBtn" data-i18n="proCopyBtn">
                  テンプレをコピー
                </button>
                <button class="btn btn-ghost" type="button" id="lockProBtn" data-i18n="proLockBtn">
                  Proをロック（テスト用）
                </button>
              </div>

              <p class="note" data-i18n="proUnlockedHint">
                ※将来：DB種別プリセット、Migrationモード、より厳密な検出ルールを追加予定。
              </p>
            </div>
          </div>
          <!-- /Pro -->
        </div>
      </div>

      <div class="card">
        <p class="disclaimer" data-i18n="disclaimer">
          このツールはSQLの実行結果や安全性を保証するものではありません。本番環境では必ずバックアップ・権限・トランザクションを確認してください。
        </p>
      </div>

      <!-- 寄付導線（共通寄せ） -->
      <div class="donate">
        <p class="donate-text" data-i18n="donateText">
          このツールが役に立ったら、開発継続のためのご支援をいただけると助かります。
        </p>
        <div class="donate-links">
          <a href="https://ofuse.me/nicheworks" target="_blank" rel="noopener">💌 OFUSE</a>
          <a href="https://ko-fi.com/nicheworks" target="_blank" rel="noopener">☕ Ko-fi</a>
        </div>
      </div>
    </section>

    <div class="ad-slot ad-bottom">広告枠（準備中）</div>
  </main>

  <footer class="footer">
    <p>© NicheWorks</p>
    <p>Ads may be displayed. Accuracy not guaranteed. Verify with official sources.</p>
  </footer>

  <script src="./app.js" defer></script>
</body>
</html>
