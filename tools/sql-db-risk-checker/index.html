<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>SQL / DB 実行前リスクチェッカー｜NicheWorks</title>
  <meta name="description" content="SQLを実行前に貼るだけ。破壊的操作・WHERE抜け・全件更新/削除などを検出し、危険度と理由を表示します。ブラウザ完結・保存なし。" />

  <link rel="canonical" href="https://nicheworks.pages.dev/tools/sql-db-risk-checker/" />

  <meta property="og:type" content="website" />
  <meta property="og:title" content="SQL / DB 実行前リスクチェッカー｜NicheWorks" />
  <meta property="og:description" content="SQLを実行前に貼るだけ。破壊的操作・WHERE抜け・全件更新/削除などを検出し、危険度と理由を表示。" />
  <meta property="og:url" content="https://nicheworks.pages.dev/tools/sql-db-risk-checker/" />

  <link rel="icon" href="/assets/favicon.png" />
  <link rel="stylesheet" href="./style.css" />
</head>

<body>
  <header class="nw-header">
    <div class="nw-header-inner">
      <a class="nw-brand" href="https://nicheworks.pages.dev/">
        <img class="nw-logo" src="/assets/nicheworks-logo.png" alt="NicheWorks" />
        <span class="nw-brand-text">NicheWorks</span>
      </a>

      <div class="nw-header-right">
        <a class="nw-header-link" href="https://nicheworks.pages.dev/tools/">Tools</a>
      </div>
    </div>
  </header>

  <main class="nw-main">
    <!-- 上部広告枠（必須） -->
    <div class="ad-slot ad-top">
      広告枠（準備中）
      <!-- 審査通過後に広告コード -->
    </div>

    <!-- ✅ ここ：ad-top直下に「簡易使い方 + usageリンク + 実行前チェックリスト」 -->
    <section class="nw-intro-card" aria-label="How to use + checklist">
      <div class="nw-intro-head">
        <h1 class="nw-title">SQL / DB 実行前リスクチェッカー</h1>
        <p class="nw-subtitle">
          実行する前に「事故るSQL」を止めるだけ。<strong>SQLは修正しません</strong>（判定と理由の提示のみ）。
        </p>
      </div>

      <div class="nw-intro-grid">
        <div class="nw-intro-block">
          <h2 class="nw-h2">簡易的な使い方</h2>
          <ol class="nw-steps">
            <li>SQLを貼り付け（複数文OK）</li>
            <li>必要なら「対象環境」「DB種別」「読み取り専用」を選択</li>
            <li><strong>リスクチェック</strong> → 危険度／警告／ハイライトを確認</li>
          </ol>

          <div class="nw-usage-link">
            <a href="./usage.html" class="nw-link">詳しい使い方（Usage）を見る →</a>
          </div>

          <p class="nw-note">
            ※このツールは実行結果や安全性を保証しません。最終判断はあなたが行ってください。
          </p>
        </div>

        <div class="nw-intro-block">
          <h2 class="nw-h2">実行前チェックリスト</h2>
          <ul class="nw-checklist" id="preChecklist">
            <li><label><input type="checkbox"> 対象DBは本番ですか？（Prodなら慎重に）</label></li>
            <li><label><input type="checkbox"> バックアップ／ロールバック手段はありますか？</label></li>
            <li><label><input type="checkbox"> 影響行数を事前に確認しましたか？（SELECT COUNTなど）</label></li>
            <li><label><input type="checkbox"> 権限は最小限ですか？（必要なロールのみ）</label></li>
            <li><label><input type="checkbox"> トランザクションで囲むべきですか？（BEGIN/ROLLBACK/COMMIT）</label></li>
          </ul>

          <div class="nw-checklist-actions">
            <button class="nw-btn nw-btn-ghost" type="button" id="checkAllBtn">全部チェック</button>
            <button class="nw-btn nw-btn-ghost" type="button" id="clearAllBtn">全部外す</button>
          </div>
        </div>
      </div>
    </section>

    <!-- ツール本体 -->
    <section class="nw-tool">
      <div class="nw-card">
        <h2 class="nw-h2">SQL入力</h2>
        <textarea
          id="sqlInput"
          class="nw-textarea"
          rows="10"
          spellcheck="false"
          placeholder="ここにSQLを貼り付けてください（複数文OK / ; 区切り）
例:
DELETE FROM users WHERE id = 123;
"
        ></textarea>

        <div class="nw-options">
          <div class="nw-option">
            <label class="nw-label" for="envSelect">対象環境（自己申告）</label>
            <select id="envSelect" class="nw-select">
              <option value="unknown">Unknown</option>
              <option value="dev">Dev</option>
              <option value="staging">Staging</option>
              <option value="prod">Prod</option>
            </select>
            <p class="nw-help">※実際の接続先を判定するものではありません</p>
          </div>

          <div class="nw-option">
            <label class="nw-label" for="dbSelect">DB種別</label>
            <select id="dbSelect" class="nw-select">
              <option value="generic">Generic</option>
              <option value="postgres">Postgres</option>
              <option value="mysql">MySQL</option>
              <option value="sqlite">SQLite</option>
            </select>
          </div>

          <div class="nw-option nw-option-inline">
            <label class="nw-label" for="readOnlyToggle">読み取り専用モード</label>
            <label class="nw-switch">
              <input id="readOnlyToggle" type="checkbox" />
              <span class="nw-slider" aria-hidden="true"></span>
            </label>
            <p class="nw-help">ONにするとSELECT以外を強く警告します</p>
          </div>
        </div>

        <div class="nw-actions">
          <button id="checkBtn" class="nw-btn nw-btn-primary" type="button">リスクチェック</button>
          <button id="clearBtn" class="nw-btn nw-btn-ghost" type="button">クリア</button>

          <div class="nw-badge-wrap">
            <span class="nw-badge-label">リスク判定</span>
            <span id="riskBadge" class="risk-badge risk-low">Low（低）</span>
          </div>
        </div>
      </div>

      <div class="nw-grid-2">
        <div class="nw-card">
          <h2 class="nw-h2">検出サマリー</h2>
          <div class="nw-summary" id="summary">
            <div class="nw-summary-item"><span>文数</span><strong id="sumStatements">0</strong></div>
            <div class="nw-summary-item"><span>書き込み系操作</span><strong id="sumWrites">0</strong></div>
            <div class="nw-summary-item"><span>危険キーワード数</span><strong id="sumKeywords">0</strong></div>
          </div>

          <h2 class="nw-h2">警告一覧</h2>
          <ul id="warningsList" class="nw-warnings">
            <li class="nw-empty">まだ結果はありません。SQLを入力して「リスクチェック」を押してください。</li>
          </ul>
        </div>

        <div class="nw-card">
          <h2 class="nw-h2">SQLプレビュー（危険箇所を強調表示）</h2>
          <pre id="sqlPreview" class="nw-preview"><code>ここに解析結果が表示されます</code></pre>

          <div class="nw-probox">
            <div class="nw-probox-head">
              <h3 class="nw-h3">Pro機能（買い切り）</h3>
              <span class="nw-protag">Coming soon</span>
            </div>
            <ul class="nw-prolist">
              <li>安全実行テンプレの提示（トランザクション手順）</li>
              <li>DB種別ごとの注意点表示</li>
              <li>ルールプリセット（Read-only強制 / Migrationモード）</li>
            </ul>
            <p class="nw-note">※SQLの自動修正は行いません</p>
          </div>
        </div>
      </div>

      <div class="nw-card">
        <p class="nw-disclaimer">
          このツールはSQLの実行結果や安全性を保証するものではありません。
          本番環境では必ずバックアップ・権限・トランザクションを確認してください。
        </p>
      </div>
    </section>

    <!-- 下部広告枠（任意） -->
    <div class="ad-slot ad-bottom">
      広告枠（準備中）
      <!-- 審査通過後に広告コード -->
    </div>

    <!-- 寄付導線（必要になったら共通仕様に従って追加） -->
  </main>

  <footer class="nw-footer">
    <div class="nw-footer-inner">
      <p class="nw-footer-title">NicheWorks</p>
      <p class="nw-footer-note">Browser-only / No data is sent.（ブラウザ完結・送信なし）</p>
      <p class="nw-footer-links">
        <a href="https://nicheworks.pages.dev/">Home</a>
        <span>·</span>
        <a href="https://nicheworks.pages.dev/tools/">Tools</a>
      </p>
      <p class="nw-footer-copy">© NicheWorks</p>
    </div>
  </footer>

  <script src="./app.js" defer></script>
</body>
</html>
